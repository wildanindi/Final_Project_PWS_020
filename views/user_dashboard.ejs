<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-5">
    <div>
        <h2>ğŸ‘¤ User Dashboard</h2>
        <span class="badge <%= user.payment_status === 'paid' ? 'bg-success' : 'bg-warning text-dark' %>">
            Status: <%= user.payment_status === 'paid' ? 'Premium User' : 'Free User (Belum Bayar)' %>
        </span>
    </div>
    <a href="/auth/logout" class="btn btn-outline-danger btn-sm">Logout</a>
</div>

<% if (error) { %>
    <div class="alert alert-danger text-center" role="alert">
        âš ï¸ <%= error %>
    </div>
<% } %>

<div class="row g-4">
    
    <% if (user.payment_status === 'unpaid') { %>
        <div class="col-md-12">
            <div class="card p-5 text-center border-warning border-3">
                <h1 class="display-4">ğŸ”’</h1>
                <h3 class="fw-bold mt-3">Akses Terkunci</h3>
                <p class="text-muted lead">Untuk generate API Key dan melihat menu, kamu harus berlangganan paket Premium.</p>
                
                <div class="card bg-light p-3 d-inline-block my-3" style="max-width: 400px; margin: 0 auto;">
                    <h5 class="fw-bold">Paket Menu Sultan</h5>
                    <p class="mb-0">Rp 50.000 / seumur hidup</p>
                </div>
                <br>

                <form action="/user/pay" method="POST">
                    <button type="submit" class="btn btn-warning btn-lg fw-bold px-5" onclick="return confirm('Yakin mau bayar Rp 50.000?')">
                        ğŸ’° Bayar Sekarang
                    </button>
                </form>
                <small class="text-muted mt-2 d-block">*Ini simulasi, saldo kamu gak kepotong beneran kok.</small>
            </div>
        </div>

    <% } else { %>
        <div class="col-md-6">
            <div class="card p-4 bg-white h-100 border-start border-4 border-primary">
                <h4 class="fw-bold text-primary">Langkah 1</h4>
                <p class="text-muted">Generate API Key kamu untuk mendapatkan akses.</p>
                
                <div class="alert alert-secondary text-break font-monospace text-center fs-5">
                    <%= user.api_key ? user.api_key : '--- Klik Generate Dulu ---' %>
                </div>

                <form action="/user/generate-key" method="POST" class="mt-auto">
                    <button type="submit" class="btn btn-primary w-100">
                        ğŸ”„ Generate API Key Saya
                    </button>
                </form>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-4 bg-white h-100 border-start border-4 border-success">
                <h4 class="fw-bold text-success">Langkah 2</h4>
                <p class="text-muted">Copy key di samping, lalu paste di bawah ini.</p>

                <form action="/user/validate-key" method="POST" class="mt-3">
                    <div class="input-group mb-3">
                        <input type="text" name="input_key" class="form-control form-control-lg" placeholder="Tempel API Key disini..." required>
                    </div>
                    <button type="submit" class="btn btn-success w-100 py-2 fw-bold">
                        ğŸ”“ Buka Daftar Menu
                    </button>
                </form>
            </div>
        </div>

    <% } %>
    </div>

<%- include('partials/footer') %>